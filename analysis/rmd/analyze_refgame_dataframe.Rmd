---
title: "graphical_conventions"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggthemes)
library(lme4)
library(lmerTest)
library(brms)
#library(Rmisc)
library(tidyboot)
```

## Import group data

```{r}
d <- read_csv('../../results/graphical_conventions.csv')  %>% select(-png)
d.bis.drawDuration <- read_csv('../../results/graphical_conventions_bis_score_drawDuration.csv')  %>% select(-X1)
d.bis.numStrokes <- read_csv('../../results/graphical_conventions_bis_score_numStrokes.csv') %>% select(-X1)
```

## Generate histograms for numCurvesPerSketch and numStrokes 

```{r}
d %>% 
  group_by(numCurvesPerSketch) %>% ggplot(aes(x = numCurvesPerSketch)) + geom_histogram()
```

```{r}
d %>% 
  group_by(numStrokes) %>% ggplot(aes(x = numStrokes)) + geom_histogram()
```

## Behavioral Results: BIS analysis (on drawDuration)

```{r}
d.bootstrap <- d.bis.drawDuration %>% group_by(condition, repetition) %>% tidyboot_mean(column=bis_score)
d.bootstrap %>%
  ggplot(aes(x=repetition,y=empirical_stat, color=condition, fill=condition)) + 
    geom_ribbon(aes(ymin=ci_lower, ymax = ci_upper), alpha =.25, color=NA,
                data = d.bootstrap %>% filter(condition == 'repeated')) + # position = dodge, 
    geom_line()+#data = d.bootstrap %>% filter(condition == 'repeated')) + 
    geom_errorbar(aes(ymin=ci_lower, ymax = ci_upper), width = 0,
                  data = d.bootstrap %>% filter(condition == 'control')) + 
    geom_point(size = 2) + 
    scale_x_continuous(breaks = round(seq(min(d.bootstrap$repetition), max(d.bootstrap$repetition), by =1),1)) + 
    ylab("BIS") +
    #ylim(-1,1) +
    theme_bw() +
    scale_color_manual(values=c("#cc0000", "#0066cc")) + 
    scale_fill_manual(values=c("#cc0000", "#0066cc")) + 
  theme(legend.position = c(0.9, 0.2))
ggsave('../../writing/cogsci19/figures/bis_score.pdf', width=20, height = 15, units='cm')

```

## Mixed-effects model for BIS (on drawDuration)

```{r}
#lmer model for interaction between repetition and condition for bis (right syntax but doesn't converge)
interaction_lmm <- lmer(bis_score ~ phase * condition + (1 + phase*condition | gameID) + (1 + phase*condition | target), data = d.bis.drawDuration %>%
                          filter(repetition == 0 | repetition == 7) %>% mutate(phase = ifelse(repetition == 0, 'pre', 'post'))) 
coef(summary(interaction_lmm))
```

## Within-interaction convergence

```{r}


```

## Between-interaction divergence 

```{r}


```

## Temporal structure 

```{r}


```

# Recognition timecourse analyses 

```{r}

d.recog <- read_csv('../../results/graphical_conventions_recog_data.csv') %>%
  mutate(version = factor(version))

```

### get bootstrapped accuracy x repetition, broken out by version
```{r}
d.recog.boot = d.recog %>%
  group_by(version,repetition) %>%
  tidyboot_mean(col=correct)
```
### plot it
```{r}
d.recog.boot %>%  
  ggplot(aes(x = repetition, y = empirical_stat, color = version, fill = version)) +
  geom_line() +
  # geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper, width = 0)) +
  geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper), alpha = 0.2, color = NA) +
  ylim(0,1) +
  ylab('accuracy') +
  geom_hline(aes(yintercept=0.25),linetype='dashed') +
  scale_x_continuous(breaks=seq(0,7,by=1)) + 
  theme_minimal() 
```
### mixed-effects modeling on accuracy
```{r}
summary(glmer(correct ~ version * repetition + (1 + repetition | gameID) + (1 + repetition | target), family = binomial, 
              data = d.recog %>% filter(version %in% c('yoked', 'scrambled40'))))

#str(d.recog)
```

### plotting BIS (balancing accuracy vs. drawDuration) from refgame, yoked, and scrambled40 experiments

```{r}
## TODO 12/26/2018


```

### mixed-effects modeling of BIS (balancing accuracy vs. drawDuration) from refgame, yoked, and scrambled40 experiments

```{r}
## TODO 12/26/2018


```